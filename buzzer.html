<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Realistic Game Buzzer</title>
    <style>
        :root {
            --primary: #eb4d4b; /* Default Red */
            --primary-dark: #c0392b;
            --bg: #1e272e;
            --text: #ffffff;
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            padding: 0;
            /* Fallback for older browsers */
            height: 100vh;
            /* Fix for mobile browsers (accounts for address bar) */
            height: 100dvh; 
            background-color: var(--bg);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: background-color 0.4s ease;
        }

        /* Header Area */
        header {
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            z-index: 20;
            flex-shrink: 0; /* Prevent header from squishing too much */
        }
        
        h1 {
            margin: 0;
            color: white;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.8;
        }

        /* Volume Reminder */
        .volume-alert {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(4px);
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            animation: pulse-border 2s infinite;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        @keyframes pulse-border {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
            70% { transform: scale(1.02); box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }

        /* Main Button Area */
        main {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            min-height: 0; /* Allows flex child to shrink properly */
        }

        #buzzer-btn {
            width: min(70vw, 280px); /* Slightly smaller max width to ensure fit */
            height: min(70vw, 280px);
            border-radius: 50%;
            border: none;
            background: linear-gradient(145deg, var(--primary), var(--primary-dark));
            box-shadow: 
                0 15px 0 var(--primary-dark), 
                0 25px 20px rgba(0,0,0,0.4),
                inset 0 10px 20px rgba(255,255,255,0.25);
            color: white;
            font-size: 2.5rem;
            font-weight: 800;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            cursor: pointer;
            position: relative;
            /* Made transition snappier for "bouncy" feel */
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.1s; 
            outline: none;
            touch-action: manipulation;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-appearance: none; /* iOS fix */
        }

        #buzzer-btn:active, #buzzer-btn.pressed {
            transform: scale(0.95) translateY(10px);
            box-shadow: 
                0 0 0 var(--primary-dark), 
                0 5px 10px rgba(0,0,0,0.4);
        }

        /* Particle Explosion Effect */
        .particle {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 15;
            animation: particle-anim 0.8s ease-out forwards;
        }

        @keyframes particle-anim {
            0% { transform: translate(0, 0) scale(1) rotate(0deg); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0) rotate(180deg); opacity: 0; }
        }

        /* Visual Ripple Effect (Internal) */
        .ripple {
            position: absolute;
            border-radius: 50%;
            transform: scale(0);
            animation: ripple-anim 0.5s linear;
            background-color: rgba(255, 255, 255, 0.4);
            pointer-events: none;
        }

        @keyframes ripple-anim {
            to { transform: scale(3.5); opacity: 0; }
        }

        /* Footer / Theme Selector */
        .controls-container {
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            padding-bottom: env(safe-area-inset-bottom, 20px);
            border-top: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0; /* Prevent footer from being pushed off */
            max-height: 35vh; /* Limit height so it doesn't take over too much */
            display: flex;
            flex-direction: column;
        }

        .controls-label {
            padding: 10px 0 5px 20px;
            font-size: 0.8rem;
            text-transform: uppercase;
            color: rgba(255,255,255,0.5);
            letter-spacing: 1px;
            flex-shrink: 0;
        }

        .controls {
            display: flex; /* Changed from grid to flex for horizontal layout */
            gap: 12px;
            padding: 10px 20px 20px 20px;
            overflow-x: auto; /* Enable horizontal scroll */
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch; /* Smooth scroll on iOS */
            scrollbar-width: none; /* Hide scrollbar for cleaner look */
        }
        
        /* Hide scrollbar for Chrome/Safari */
        .controls::-webkit-scrollbar {
            display: none;
        }
        
        .theme-card {
            min-width: 85px; /* Restored min-width so they don't squish */
            height: 95px;
            background: #2d3436;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            opacity: 0.7;
            transition: all 0.2s ease;
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
            flex-shrink: 0; /* Important: prevents items from shrinking to fit screen */
        }

        .theme-card.active {
            opacity: 1;
            background: #353b48;
            border-color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .theme-icon { font-size: 2rem; margin-bottom: 8px; }

        /* Shake Animation for Whole Screen */
        .shake { animation: shake 0.2s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-6px, 0, 0); }
            40%, 60% { transform: translate3d(6px, 0, 0); }
        }

    </style>
</head>
<body>

    <header>
        <h1>Game Buzzer</h1>
        <div class="volume-alert">
            <span>ðŸ”Š</span>
            <span>Turn up volume!</span>
        </div>
    </header>

    <main>
        <button id="buzzer-btn">BUZZ!</button>
    </main>

    <div class="controls-container">
        <div class="controls-label">Select Sound</div>
        <div class="controls">
            <!-- Content will be injected by JavaScript for randomization -->
        </div>
    </div>

    <script>
        // --- AUDIO CONFIGURATION ---
        
        // Added 'text' field for dynamic button labels
        const themes = {
            buzzer: { 
                label: 'Buzzer', icon: 'ðŸš¨', text: 'BUZZ!',
                color: '#eb4d4b', dark: '#c0392b',
                url: 'https://assets.mixkit.co/active_storage/sfx/950/950-preview.mp3' 
            },
            ding: {
                label: 'Correct', icon: 'âœ…', text: 'YES!',
                color: '#26de81', dark: '#20bf6b',
                url: 'https://assets.mixkit.co/active_storage/sfx/571/571-preview.mp3'
            },
            fail: {
                label: 'Fail', icon: 'ðŸ“‰', text: 'NO!',
                color: '#95a5a6', dark: '#7f8c8d',
                url: 'https://assets.mixkit.co/active_storage/sfx/953/953-preview.mp3'
            },
            levelup: {
                label: 'Level Up', icon: 'ðŸŒŸ', text: 'UP!',
                color: '#f1c40f', dark: '#f39c12',
                url: 'https://assets.mixkit.co/active_storage/sfx/2065/2065-preview.mp3'
            },
            arcade: {
                label: 'Arcade', icon: 'ðŸ•¹ï¸', text: 'GO!',
                color: '#e84118', dark: '#c23616',
                // Classic 8-bit powerup/bonus sound
                url: 'https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3'
            },
            crickets: {
                label: 'Crickets', icon: 'ðŸ¦—', text: '...',
                color: '#badc58', dark: '#6ab04c',
                url: 'https://assets.mixkit.co/active_storage/sfx/220/220-preview.mp3'
            },
            laser: { 
                label: 'Laser', icon: 'ðŸ”«', text: 'ZAP!',
                color: '#0984e3', dark: '#0652dd',
                url: 'https://assets.mixkit.co/active_storage/sfx/1678/1678-preview.mp3'
            },
            dog: { 
                label: 'Dog', icon: 'ðŸ¶', text: 'WOOF!',
                color: '#e67e22', dark: '#d35400',
                url: 'https://www.google.com/logos/fnbx/animal_sounds/dog.mp3'
            },
            meow: { 
                label: 'Meow', icon: 'ðŸ±', text: 'MEOW!',
                color: '#fd79a8', dark: '#e84393',
                url: 'https://www.google.com/logos/fnbx/animal_sounds/cat.mp3'
            },
            lion: { 
                label: 'Lion', icon: 'ðŸ¦', text: 'ROAR!',
                color: '#f1c40f', dark: '#f39c12',
                url: 'https://www.google.com/logos/fnbx/animal_sounds/lion.mp3'
            },
            pig: {
                label: 'Pig', icon: 'ðŸ·', text: 'OINK!',
                color: '#ff9ff3', dark: '#f368e0',
                url: 'https://www.google.com/logos/fnbx/animal_sounds/pig.mp3'
            },
            cow: { 
                label: 'Cow', icon: 'ðŸ®', text: 'MOO!',
                color: '#00cec9', dark: '#00b894',
                url: 'https://www.google.com/logos/fnbx/animal_sounds/cow.mp3'
            },
            rooster: { 
                label: 'Rooster', icon: 'ðŸ“', text: 'CLUCK!',
                color: '#d63031', dark: '#c0392b',
                url: 'https://www.google.com/logos/fnbx/animal_sounds/rooster.mp3'
            },
            elephant: { 
                label: 'Elephant', icon: 'ðŸ˜', text: 'TOOT!',
                color: '#a4b0be', dark: '#747d8c',
                url: 'https://www.google.com/logos/fnbx/animal_sounds/elephant.mp3'
            },
            duck: { 
                label: 'Duck', icon: 'ðŸ¦†', text: 'QUACK!',
                color: '#f9ca24', dark: '#f0932b',
                url: 'https://www.google.com/logos/fnbx/animal_sounds/duck.mp3'
            }
        };

        // --- AUDIO ENGINE ---
        
        const masterPlayer = new Audio();
        let currentTheme = 'buzzer';
        let wakeLock = null;

        masterPlayer.addEventListener('error', (e) => {
            console.error("Error loading sound:", masterPlayer.src, e);
        });

        // Fisher-Yates Shuffle
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Initialize
        function init() {
            // 1. Generate Random Order of Buttons
            const controlsDiv = document.querySelector('.controls');
            controlsDiv.innerHTML = ''; // Clear just in case
            
            const keys = Object.keys(themes);
            shuffle(keys);

            keys.forEach(key => {
                const theme = themes[key];
                const card = document.createElement('div');
                card.className = 'theme-card';
                card.dataset.theme = key;
                card.onclick = () => setTheme(key);
                card.innerHTML = `
                    <span class="theme-icon">${theme.icon}</span>
                    <span>${theme.label}</span>
                `;
                controlsDiv.appendChild(card);
            });

            // 2. Set Initial Theme (Always start with Buzzer active, regardless of position)
            setTheme('buzzer');
            
            // 3. Interaction Listener for iOS/Wake Lock
            const unlockHandler = async function() {
                masterPlayer.load();
                requestWakeLock();
                document.body.removeEventListener('touchstart', unlockHandler);
                document.body.removeEventListener('click', unlockHandler);
            };

            document.body.addEventListener('touchstart', unlockHandler);
            document.body.addEventListener('click', unlockHandler);
            
            document.addEventListener('visibilitychange', async () => {
                if (wakeLock !== null && document.visibilityState === 'visible') {
                    requestWakeLock();
                }
            });
        }

        // --- WAKE LOCK (Keep Screen On) ---
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('Wake Lock active');
                    wakeLock.addEventListener('release', () => {
                        console.log('Wake Lock released');
                    });
                }
            } catch (err) {
                console.log('Wake Lock denied:', err.name, err.message);
            }
        }

        // --- THEME & AUDIO LOGIC ---

        window.setTheme = function(themeKey) {
            currentTheme = themeKey;
            const config = themes[themeKey];
            
            // 1. Visual Updates
            const root = document.documentElement;
            root.style.setProperty('--primary', config.color);
            root.style.setProperty('--primary-dark', config.dark);
            
            // Update Text
            const btn = document.getElementById('buzzer-btn');
            btn.innerText = config.text || "PUSH";

            document.querySelectorAll('.theme-card').forEach(card => {
                card.classList.remove('active');
                if(card.dataset.theme === themeKey) card.classList.add('active');
            });

            // 2. Audio Pre-loading
            masterPlayer.src = config.url;
            masterPlayer.load(); 
        };

        function playSound() {
            // POLYPHONY IMPLEMENTATION
            const clone = masterPlayer.cloneNode();
            const promise = clone.play();
            if (promise !== undefined) {
                promise.catch(error => {
                    console.log("Autoplay prevented or network error.", error);
                });
            }
            clone.addEventListener('ended', () => {
                clone.remove();
            });
        }
        
        // --- VISUAL EFFECTS ---

        function createParticles(x, y, color) {
            for (let i = 0; i < 15; i++) {
                const p = document.createElement('div');
                p.classList.add('particle');
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                p.style.backgroundColor = color;
                
                // Random angle and distance
                const angle = Math.random() * Math.PI * 2;
                const velocity = 80 + Math.random() * 120; // Spread distance
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;
                
                p.style.setProperty('--tx', `${tx}px`);
                p.style.setProperty('--ty', `${ty}px`);
                
                document.body.appendChild(p);
                
                // Cleanup
                setTimeout(() => p.remove(), 800);
            }
        }

        // --- INTERACTION HANDLING ---

        const btn = document.getElementById('buzzer-btn');

        function triggerBuzzer(e) {
            if(e.cancelable && e.type === 'touchstart') e.preventDefault();
            
            // 1. HAPTIC FEEDBACK (Vibration)
            if (navigator.vibrate) {
                try {
                    navigator.vibrate(200); 
                } catch(err) {
                    // Fail silently
                }
            }

            // 2. Sound (Polyphonic)
            playSound();

            // 3. Visuals (Shake + Press)
            btn.classList.add('pressed');
            
            // 4. Screen Shake
            document.body.classList.remove('shake');
            void document.body.offsetWidth; // Force reflow
            document.body.classList.add('shake');

            // 5. Particles & Ripple
            // Calculate coords for particles
            let clientX, clientY;
            if (e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            
            // Ripple inside button
            createRipple(e);
            
            // Particles outside button
            const config = themes[currentTheme];
            // Use lighter color for particles so they show up against background
            createParticles(clientX, clientY, config.color);
        }

        function releaseBuzzer() {
            btn.classList.remove('pressed');
        }

        function createRipple(e) {
            const circle = document.createElement("span");
            const diameter = Math.max(btn.clientWidth, btn.clientHeight);
            const radius = diameter / 2;
            
            let clientX, clientY;
            if (e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            const rect = btn.getBoundingClientRect();
            
            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${clientX - rect.left - radius}px`;
            circle.style.top = `${clientY - rect.top - radius}px`;
            circle.classList.add("ripple");

            const existing = btn.getElementsByClassName("ripple");
            while (existing.length > 1) { existing[0].remove(); }

            btn.appendChild(circle);
        }

        // Event Listeners
        btn.addEventListener('touchstart', triggerBuzzer, { passive: false });
        btn.addEventListener('touchend', releaseBuzzer);
        
        btn.addEventListener('mousedown', triggerBuzzer);
        btn.addEventListener('mouseup', releaseBuzzer);
        btn.addEventListener('mouseleave', releaseBuzzer);

        // Start
        init();

    </script>
</body>
</html>